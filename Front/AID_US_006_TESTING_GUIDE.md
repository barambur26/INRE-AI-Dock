# AID-US-006 Testing Guide: Admin Definition of Department-Based Usage Quotas\n\n## Overview\nThis guide provides step-by-step instructions for testing the quota management functionality implemented in AID-US-006.\n\n## Prerequisites\nBefore testing, ensure:\n1. **Backend is running** with the new quota endpoints\n2. **Frontend is running** with the updated admin interface\n3. **Authentication is working** (you can log in as an admin user)\n4. **Departments exist** (from AID-US-002)\n5. **LLM configurations exist** (from AID-US-003)\n\n## Test Scenarios\n\n### üîê **Test 1: Access Control**\n**Objective:** Verify only admin users can access quota management\n\n**Steps:**\n1. Log in with a non-admin user account\n2. Navigate to Admin Settings\n3. **Expected:** Should be redirected/blocked from accessing admin panel\n4. Log in with an admin user account\n5. Navigate to Admin Settings\n6. **Expected:** Should see \"Quotas\" tab in the admin interface\n\n---\n\n### üìä **Test 2: Quota Templates**\n**Objective:** Test the predefined quota templates\n\n**Steps:**\n1. Go to Admin Settings > Quotas tab\n2. Click \"Add Quota\"\n3. In the \"Quick Setup Template\" dropdown, select different templates:\n   - **Small Department**: 100K monthly tokens, 5K daily, soft warning\n   - **Medium Department**: 250K monthly tokens, 10K daily, soft warning\n   - **Large Department**: 500K monthly tokens, 20K daily, soft warning\n   - **Unlimited**: 0 limits (unlimited)\n4. **Expected:** Form fields should auto-populate with template values\n5. **Expected:** Template descriptions should be clear and helpful\n\n---\n\n### ‚úÖ **Test 3: Create New Quota (Happy Path)**\n**Objective:** Successfully create a quota with valid data\n\n**Steps:**\n1. Go to Admin Settings > Quotas tab\n2. Click \"Add Quota\"\n3. Fill in the form:\n   - **Department:** Select \"IT\" (or any existing department)\n   - **LLM Model:** Select \"gpt-4\" (or any existing LLM config)\n   - **Monthly Token Limit:** 100000\n   - **Daily Token Limit:** 5000\n   - **Monthly Request Limit:** 1000\n   - **Daily Request Limit:** 50\n   - **Enforcement Mode:** Soft Warning\n   - **Warning Threshold:** 80%\n4. Click \"Create Quota\"\n5. **Expected:** Success message appears\n6. **Expected:** New quota appears in the quotas list\n7. **Expected:** Quota shows correct department and LLM model names\n\n---\n\n### ‚ùå **Test 4: Create Quota Validation**\n**Objective:** Test form validation and error handling\n\n**Steps:**\n1. Try to create a quota without selecting a department\n2. **Expected:** Submit button should be disabled\n3. Try to create a quota without selecting an LLM model\n4. **Expected:** Submit button should be disabled\n5. Try to create a duplicate quota (same department + LLM combination)\n6. **Expected:** Should show error message about existing quota\n7. Test with invalid values:\n   - Negative token limits\n   - Warning threshold > 100%\n8. **Expected:** Form should validate and show appropriate errors\n\n---\n\n### ‚úèÔ∏è **Test 5: Edit Existing Quota**\n**Objective:** Test quota modification functionality\n\n**Steps:**\n1. From the quotas list, click \"Edit\" on an existing quota\n2. **Expected:** Form opens with current values pre-filled\n3. **Expected:** Department and LLM fields are disabled (read-only)\n4. Modify values:\n   - Change monthly limit from 100000 to 150000\n   - Change enforcement mode from \"Soft Warning\" to \"Hard Block\"\n   - Change warning threshold from 80% to 90%\n5. Click \"Update Quota\"\n6. **Expected:** Success message appears\n7. **Expected:** Updated values are reflected in the quotas list\n\n---\n\n### üóëÔ∏è **Test 6: Delete Quota**\n**Objective:** Test quota deletion functionality\n\n**Steps:**\n1. From the quotas list, click \"Delete\" on a quota\n2. **Expected:** Confirmation dialog appears\n3. Click \"Cancel\" in the confirmation dialog\n4. **Expected:** Quota remains in the list\n5. Click \"Delete\" again and confirm\n6. **Expected:** Success message appears\n7. **Expected:** Quota is removed from the list\n\n---\n\n### üìà **Test 7: Quota Overview Stats**\n**Objective:** Test the quota statistics dashboard\n\n**Steps:**\n1. Create several quotas with different usage levels\n2. **Expected:** Overview cards should show:\n   - Total Quotas count\n   - Exceeded Quotas count (should be 0 initially)\n   - Warning Quotas count (should be 0 initially)\n   - Average Usage percentage\n3. **Expected:** Stats should update when quotas are added/removed\n\n---\n\n### üîç **Test 8: Quota Filtering**\n**Objective:** Test the quota filtering functionality\n\n**Steps:**\n1. Create quotas with different usage scenarios:\n   - Some with normal usage (< 80%)\n   - Some with warning usage (80-99%)\n   - Some with exceeded usage (100%+)\n2. Click \"Exceeded Only\" filter\n3. **Expected:** Only quotas with exceeded limits are shown\n4. Click \"Warning Only\" filter\n5. **Expected:** Only quotas with warning status are shown\n6. Click \"Clear Filters\"\n7. **Expected:** All quotas are shown again\n\n---\n\n### üîÑ **Test 9: Bulk Operations (Future Enhancement)**\n**Objective:** Test bulk quota creation (if implemented)\n\n**Steps:**\n1. Click \"Bulk Create\" button\n2. Select multiple departments and LLM configurations\n3. Choose a template or custom settings\n4. **Expected:** Multiple quotas are created for all combinations\n5. **Expected:** Success/error count is reported\n\n---\n\n### üè∑Ô∏è **Test 10: Quota Status Badges**\n**Objective:** Test visual indicators for quota status\n\n**Steps:**\n1. View quotas list with different usage levels\n2. **Expected:** Status badges should show:\n   - **Green \"OK\"** for normal usage (< warning threshold)\n   - **Orange \"WARNING\"** for high usage (‚â• warning threshold)\n   - **Red \"EXCEEDED\"** for over-limit usage\n3. **Expected:** Badge colors should be clear and distinguishable\n\n---\n\n### üì± **Test 11: Responsive Design**\n**Objective:** Test quota management on different screen sizes\n\n**Steps:**\n1. Test on desktop (1920x1080)\n2. Test on tablet (768x1024)\n3. Test on mobile (375x667)\n4. **Expected:** Interface should be usable on all screen sizes\n5. **Expected:** Tables should scroll horizontally on small screens\n6. **Expected:** Forms should stack vertically on mobile\n\n---\n\n### üîó **Test 12: Integration with Existing Features**\n**Objective:** Test quota integration with other admin features\n\n**Steps:**\n1. Create a quota for a department\n2. Go to Departments tab and view the department\n3. **Expected:** Department should show quota information (if implemented)\n4. Go to LLM Config tab and view an LLM configuration\n5. **Expected:** LLM config should show related quotas (if implemented)\n6. Delete a department that has quotas\n7. **Expected:** Should either prevent deletion or handle gracefully\n\n---\n\n## API Testing\n\n### üîß **Backend API Endpoints to Test**\n\nUse tools like Postman, curl, or browser dev tools to test:\n\n```bash\n# Get quota templates\nGET /api/v1/admin/quotas/templates\n\n# Get all quotas\nGET /api/v1/admin/quotas\n\n# Get quota overview stats\nGET /api/v1/admin/quotas/overview\n\n# Create a new quota\nPOST /api/v1/admin/quotas\n{\n  \"department_id\": \"uuid\",\n  \"llm_config_id\": \"uuid\",\n  \"monthly_limit_tokens\": 100000,\n  \"daily_limit_tokens\": 5000,\n  \"monthly_limit_requests\": 1000,\n  \"daily_limit_requests\": 50,\n  \"enforcement_mode\": \"soft_warning\",\n  \"warning_threshold_percent\": 80\n}\n\n# Update a quota\nPUT /api/v1/admin/quotas/{quota_id}\n\n# Delete a quota\nDELETE /api/v1/admin/quotas/{quota_id}\n\n# Get department quotas\nGET /api/v1/admin/quotas/department/{department_id}\n\n# Bulk create quotas\nPOST /api/v1/admin/quotas/bulk\n```\n\n---\n\n## Error Scenarios to Test\n\n### ‚ö†Ô∏è **Common Error Cases**\n1. **Invalid UUIDs**: Use malformed UUIDs in requests\n2. **Non-existent resources**: Reference deleted departments/LLMs\n3. **Permission errors**: Access with non-admin users\n4. **Network errors**: Test with backend offline\n5. **Validation errors**: Send invalid data types/ranges\n6. **Duplicate creation**: Try to create same quota twice\n\n---\n\n## Performance Testing\n\n### üöÄ **Load Testing Scenarios**\n1. Create 100+ quotas and test list performance\n2. Test filtering with large quota datasets\n3. Test concurrent quota creation/modification\n4. Test quota statistics calculation with many quotas\n\n---\n\n## Browser Compatibility\n\n### üåê **Test in Multiple Browsers**\n- Chrome (latest)\n- Firefox (latest)\n- Safari (latest)\n- Edge (latest)\n\n---\n\n## Expected Completion Criteria\n\n‚úÖ **All tests pass successfully**\n‚úÖ **No console errors in browser**\n‚úÖ **Admin can create, edit, and delete quotas**\n‚úÖ **Quota templates work correctly**\n‚úÖ **Status badges and filters function properly**\n‚úÖ **Form validation prevents invalid submissions**\n‚úÖ **Responsive design works on all screen sizes**\n‚úÖ **Integration with existing admin features**\n‚úÖ **API endpoints return correct data and status codes**\n\n---\n\n## Troubleshooting Common Issues\n\n### üîß **If quota creation fails:**\n1. Check that departments and LLM configs exist\n2. Verify admin user has proper permissions\n3. Check backend logs for validation errors\n4. Ensure database connection is working\n\n### üîß **If quotas don't display:**\n1. Check network tab for API errors\n2. Verify backend quota endpoints are running\n3. Check if user has admin privileges\n4. Look for JavaScript console errors\n\n### üîß **If form validation isn't working:**\n1. Check form field requirements and types\n2. Verify client-side validation logic\n3. Test server-side validation independently\n4. Check for conflicting CSS/JS\n\n---\n\n**Happy Testing! üéâ**\n\nIf you encounter any issues during testing, please document:\n1. Steps to reproduce\n2. Expected vs actual behavior\n3. Browser/environment details\n4. Console errors or network failures\n5. Screenshots if applicable\n